-- ~/.gshrc.gza — GShell Configuration (Ghostlang)
-- Generated by `gshell init`
--
-- This file is executed when gshell starts in interactive mode.
-- All Ghostlang language features are available here!

-- ──────────────────────────────────────────────────────────────
-- Environment Variables
-- ──────────────────────────────────────────────────────────────
setenv("EDITOR", "grim")   -- Ghost editor (or nvim, vim, code, etc.)
setenv("PAGER", "less")
setenv("SHELL", "/usr/bin/gshell")

-- ──────────────────────────────────────────────────────────────
-- Plugins
-- ──────────────────────────────────────────────────────────────
-- Load built-in plugins (from assets/plugins/)
enable_plugin("git")       -- Git aliases and helpers
-- enable_plugin("docker")    -- Docker shortcuts
-- enable_plugin("kubectl")   -- Kubernetes helpers
-- enable_plugin("network")   -- Networking utilities
-- enable_plugin("dev-tools") -- Development tool helpers
-- enable_plugin("system")    -- System information commands

-- ──────────────────────────────────────────────────────────────
-- Custom Aliases
-- ──────────────────────────────────────────────────────────────
-- Note: Git plugin provides many git aliases (gs, gd, gc, etc.)
alias("ls", "ls --color=auto")
alias("ll", "ls -lah")
alias("la", "ls -A")
alias("l", "ls -CF")
alias("...", "cd ../..")
alias("grep", "grep --color=auto")
alias("update", "sudo pacman -Syu")  -- Arch Linux

-- Editor shortcuts
alias("e", getenv("EDITOR") or "vim")
alias("vi", getenv("EDITOR") or "vim")

-- Quick navigation
alias("home", "cd ~")
alias("tmp", "cd /tmp")
alias("downloads", "cd ~/Downloads")
alias("projects", "cd ~/projects")

-- ──────────────────────────────────────────────────────────────
-- Custom Functions (Lua-like syntax!)
-- ──────────────────────────────────────────────────────────────

-- Create directory and cd into it
function mkcd(dir)
    if not dir then
        print("Usage: mkcd <directory>")
        return
    end
    exec("mkdir -p " .. dir)
    cd(dir)
    print("Created and entered: " .. dir)
end

-- Quick file backup
function backup(file)
    if not file then
        print("Usage: backup <file>")
        return
    end
    if path_exists(file) then
        -- Use date command since Ghostlang doesn't have os.date yet
        local timestamp = exec("date +%Y%m%d-%H%M%S")
        local backup_name = file .. ".backup"
        exec("cp " .. file .. " " .. backup_name)
        print("Backed up to: " .. backup_name)
    else
        error("File not found: " .. file)
    end
end

-- Extract any archive
function extract(file)
    if not file then
        print("Usage: extract <archive>")
        return
    end

    if not path_exists(file) then
        error("File not found: " .. file)
        return
    end

    -- Check file extension and extract accordingly
    if file:match("%.tar%.gz$") or file:match("%.tgz$") then
        exec("tar -xzf " .. file)
    elseif file:match("%.tar%.bz2$") or file:match("%.tbz2$") then
        exec("tar -xjf " .. file)
    elseif file:match("%.tar%.xz$") then
        exec("tar -xJf " .. file)
    elseif file:match("%.zip$") then
        exec("unzip " .. file)
    elseif file:match("%.rar$") then
        exec("unrar x " .. file)
    elseif file:match("%.7z$") then
        exec("7z x " .. file)
    else
        error("Unsupported archive format: " .. file)
    end

    print("Extracted: " .. file)
end

-- ──────────────────────────────────────────────────────────────
-- Prompt Configuration
-- ──────────────────────────────────────────────────────────────
-- GPPrompt: Native PowerLevel10k-style prompt (recommended!)
-- Features: Two-line layout, Nerd Font icons, Ghost Hacker Blue theme
gprompt_enable()

-- Alternatives:
-- 1. Starship prompt (requires `starship` binary)
--    if command_exists("starship") then
--        gprompt_disable()
--        use_starship(true)
--    end
--
-- 2. Minimal built-in prompt
--    gprompt_disable()
--    enable_git_prompt()
--
-- 3. Load custom GPPrompt theme
--    exec("source ~/.config/gshell/prompts/my-theme.gza")
--
-- Note: GPPrompt is built-in, no external dependencies!

-- ──────────────────────────────────────────────────────────────
-- Theme Configuration
-- ──────────────────────────────────────────────────────────────
-- Load vivid theme for LS_COLORS
if command_exists("vivid") then
    -- Available themes: ghost-hacker-blue, tokyonight-night, tokyonight-moon, dracula
    load_vivid_theme("ghost-hacker-blue")
end

-- ──────────────────────────────────────────────────────────────
-- History Configuration
-- ──────────────────────────────────────────────────────────────
set_history_size(10000)
set_history_file(getenv("HOME") .. "/.gshell_history")

-- ──────────────────────────────────────────────────────────────
-- Startup Message
-- ──────────────────────────────────────────────────────────────
print("🪐 GShell " .. (getenv("GSHELL_VERSION") or "0.1.0-alpha") .. " loaded")
print("Type 'help' for available commands")

-- Show git status if in a git repository
if in_git_repo() then
    local branch = git_branch()
    if branch then
        local status_marker = git_dirty() and "*" or ""
        print("📁 Git: " .. branch .. status_marker)
    end
end
